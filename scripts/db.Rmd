```{r}
library(tidyverse)
```

Connect to the DB
```{r}
con = 
  DBI::dbConnect(
    RSQLite::SQLite(),
    here::here('db', 'mesa_test_db.db')
  )

tables = 
  c(
    TAG_FIELDS,
    TAG_DATA_INSTANT_FIELDS,
    TAG_DATA_SUMMARY_FIELDS
  )
```

Create the required DB tables
```{r}
# Create the necessary tables
for (fm in tables) {
  DBI::dbCreateTable(
    con,
    name = fm$table,
    fields = fm$generate_data_type_list()
  )
}
```

```{r}
# Append data to table
DBI::dbWithTransaction(
  con,
  {
    DBI::dbAppendTable(
      conn = con, 
      name = "TAG_DATA",
      value = 
        d__$transform(
          dat__,
          output_data_field_map,
          tag_meta_field_map
        )
    )
    DBI::dbAppendTable(
      conn = con,
      name = "TAG",
      value = 
        d__$generate_tag_meta_dataframe(
          tag_meta_field_map
        )
    )
  }
)



```


```{r}
DBI::dbDisconnect(con)
```

