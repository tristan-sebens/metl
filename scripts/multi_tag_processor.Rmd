```{r}
source(here::here('bin', 'class.R'))
source(here::here('config', 'const_config.R'))
source(here::here('config', 'field_config.R'))
source(here::here('config', 'datamap_config.R'))
source(here::here('config', 'identifier_config.R'))
source(here::here('config', 'decoder_config.R'))
```


```{r}
if(!is.null(globalenv()$con)) {
  DBI::dbDisconnect(con)
}
  
con = 
  DBI::dbConnect(
    RSQLite::SQLite(),
    here::here('db', 'mesa_test_db.db')
  )
```


```{r}
tp__ = 
  .self = 
  TagProcessor(
    d = here::here('data', 'Lotek', 'LTD 1300-LTD 1000-LTD 1110-LTD 1250'),
    overwrite = F
  )

tp__$process(con)

report = 
  tp__$build_report()

report

report %>% 
  write.csv(here::here('data', 'decode_report.csv'), row.names = F)
```





```{r}
report = 
  data.tree::ToDataFrameTree(
    tp__$dir_tree__, 
    n_tags = num_leaves,
    n_decoded = num_decoded,
    "decoded",
    "decode_error"
  ) %>% 
  dplyr::mutate(pct_decoded = round(100 * n_decoded / n_tags, 1)) %>% 
  dplyr::select(dir=levelName, pct_decoded, decoded, decode_error)
```


```{r}
# List leaf directories
list.dirs(data_d) %>% 
  Filter(
    function(d) {
      length(list.dirs(d, recursive=F)) == 0
    },
    .
  )
```




















