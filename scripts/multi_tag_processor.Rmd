```{r}
# Rebuild package
source(here::here('bin', 'class.R'))
source(here::here('config', 'const_config.R'))
source(here::here('config', 'field_config.R'))
source(here::here('config', 'datamap_config.R'))
source(here::here('config', 'identifier_config.R'))
source(here::here('config', 'decoder_config.R'))

# Reset DB connection
if(!is.null(globalenv()$con)) {
  DBI::dbDisconnect(con)
}
  
con = 
  DBI::dbConnect(
    RSQLite::SQLite(),
    here::here('db', 'mesa_test_db.db')
  )

# Process tag data
tp__ = 
  .self = 
  TagProcessor(
    d = here::here('data', 'Microwave Telemetry'),
    overwrite = T
  )

tp__$process(con)

# Build and save processing report
report = 
  tp__$build_report()

report

report %>% 
  write.csv(here::here('doc', 'Processing Reports', 'Microwave Telemetry', 'mt_decode_report.csv'), row.names = F)
```





```{r}
report = 
  data.tree::ToDataFrameTree(
    tp__$dir_tree__, 
    n_tags = num_leaves,
    n_decoded = num_decoded,
    "decoded",
    "decode_error"
  ) %>% 
  dplyr::mutate(pct_decoded = round(100 * n_decoded / n_tags, 1)) %>% 
  dplyr::select(dir=levelName, pct_decoded, decoded, decode_error)
```


```{r}
# List leaf directories
list.dirs(data_d) %>% 
  Filter(
    function(d) {
      length(list.dirs(d, recursive=F)) == 0
    },
    .
  )
```




















