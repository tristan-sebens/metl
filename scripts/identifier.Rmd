```{r}
library(tidyverse)

data_d = here::here('data')
lt_d = file.path(data_d, 'Lotek')
mt_d = file.path(data_d, 'Microwave Telemetry')
so_d = file.path(data_d, 'Star Oddi')
wc_d = file.path(data_d, 'Wildlife Computers')

lotek_1000.1100.1250_d = file.path(lt_d, "LTD 1300-LTD 1000-LTD 1110-LTD 1250", "Sablefish", "3315")
lotek_1300_d = file.path(lt_d, "LTD 1300-LTD 1000-LTD 1110-LTD 1250", "Sablefish", "5712")
lotek_1400.1800_d = file.path(lt_d, "LAT 1400-LAT 1800", "Sablefish", "0507")
mt_xtag_d = file.path(mt_d, "X-Tag", "Lingcod", "128306")
so_dst_d = file.path(so_d, "DST" , "Sablefish", "JS7977")
so_dst_m_d = file.path(so_d, "DST magnetic" , "Sablefish", "JS927")
so_dst_mf_d = file.path(so_d, "DST milli-F" , "Sablefish", "JS122")
wc_bs_d = file.path(wc_d, "Benthic sPAT" , "Sleeper Shark", "175158")
wc_mp_d = file.path(wc_d, "MiniPAT" , "Sleeper Shark", "174898")
```

```{r}
Identifier_WildlifeComputers = 
  setRefClass(
    "Identifier_WildlifeComputers",
    contains = "Identifier",
    methods = 
      list(
        # So far, most WC files follow the same format
        check_for_wc_data_file = 
          function(d, file_name, ...) {
            .self$check_for_files(
              d, 
              paste0("^\\d\\d\\d\\d\\d\\d-?", file_name),
              ...
            )
          }
        
      )
  )


Identifier_WildlifeComputers_BenthicSPAT = 
  setRefClass(
    "Identifier_StarOddi_DST",
    contains = "Identifier_WildlifeComputers",
    methods = 
      list(
        identify = 
          function(d) {
            return(
              all(
                # Files that should be present
                .self$check_for_wc_data_file(d, "All.csv"),
                .self$check_for_wc_data_file(d, "Argos.csv"),
                .self$check_for_wc_data_file(d, "Corrupt.csv"),
                .self$check_for_wc_data_file(d, "Orientation.csv"),
                .self$check_for_wc_data_file(d, "RawArgos.csv"),
                .self$check_for_wc_data_file(d, "RTC.csv"),
                .self$check_for_wc_data_file(d, "Status.csv"),
                .self$check_for_files(d, "\\d\\d\\d\\d\\d\\d\\.prv"),
                # Files that should not be present
                .self$check_for_wc_data_file(d, "PDTs.csv", n=0),
                .self$check_for_wc_data_file(d, "SSTs.csv", n=0)
              )
            )
          }
      )
  )


Identifier_WildlifeComputers_BenthicSPAT()$identify(wc_bs_d)
!Identifier_WildlifeComputers_BenthicSPAT()$identify(wc_mp_d)
```


```{r}
Identifier_WildlifeComputers_MiniPAT = 
  setRefClass(
    "Identifier_WildlifeComputers_MiniPAT",
    contains = "Identifier_WildlifeComputers",
    methods = 
      list(
        identify = 
          function(d) {
            return(
              all(
                # Files that should be present
                .self$check_for_wc_data_file(d, "All.csv"),
                .self$check_for_wc_data_file(d, "Argos.csv"),
                .self$check_for_wc_data_file(d, "Corrupt.csv"),
                .self$check_for_wc_data_file(d, "Histos.csv"),
                .self$check_for_wc_data_file(d, "LightLoc.csv"),
                .self$check_for_wc_data_file(d, "RawArgos.csv"),
                .self$check_for_wc_data_file(d, "RTC.csv"),
                .self$check_for_wc_data_file(d, "Status.csv"),
                .self$check_for_wc_data_file(d, "PDTs.csv"),
                .self$check_for_wc_data_file(d, "SST.csv"),
                .self$check_for_files(d, "\\d\\d\\d\\d\\d\\d\\.prv"),
                # Files that should not be present
                .self$check_for_wc_data_file(d, "Orientation.csv", n=0)
              )
            )
          }
      )
  )

Identifier_WildlifeComputers_MiniPAT()$identify(wc_mp_d)
!Identifier_WildlifeComputers_MiniPAT()$identify(wc_bs_d)
```




































